# 节点图片调整功能说明

## 功能概述

本项目已集成 `NodeImgAdjust` 插件,支持通过拖拽方式调整节点图片的大小。

## 使用方法

### 1. 粘贴图片到节点

在思维导图中,你可以通过以下方式给节点添加图片:
- 复制图片后,选中节点,按 `Ctrl+V` 粘贴
- 从剪贴板粘贴图片数据

### 2. 调整图片大小

当节点包含图片时:

1. **显示调整按钮**
   - 将鼠标悬停在节点图片上
   - 会自动显示两个按钮:
     - 右上角: 删除按钮 (×)
     - 右下角: 调整大小按钮 (↘)

2. **拖拽调整大小**
   - 点击并按住右下角的调整按钮
   - 拖动鼠标来调整图片大小
   - 图片会保持原始宽高比例
   - **自动吸附**: 当拖拽宽度接近思维导图中其他图片的宽度时(5px以内),会自动吸附到该宽度,同时**调整按钮会变为蓝色**提示吸附状态,方便统一图片大小
   - 释放鼠标完成调整

3. **删除图片**
   - 点击右上角的删除按钮
   - 图片会从节点中移除

### 3. 尺寸限制

图片调整有以下限制:
- **最小尺寸**: 宽度和高度均不小于 50px
- **最大尺寸**: 默认继承主题配置的 `imgMaxWidth` 和 `imgMaxHeight`

## 配置选项

如果需要自定义图片调整的行为,可以在创建思维导图实例时传入以下配置:

```javascript
const mindMap = new MindMap({
  // ... 其他配置
  
  // 删除按钮和调整按钮的大小
  imgResizeBtnSize: 25,
  
  // 最小允许缩放的尺寸
  minImgResizeWidth: 50,
  minImgResizeHeight: 50,
  
  // 是否继承主题的最大尺寸配置
  maxImgResizeWidthInheritTheme: false,
  
  // 最大允许缩放的尺寸(当 maxImgResizeWidthInheritTheme 为 false 时生效)
  maxImgResizeWidth: Infinity,
  maxImgResizeHeight: Infinity,
  
  // 删除图片前的拦截函数
  beforeDeleteNodeImg: (node) => {
    // 返回 true 取消删除,返回 false 或不返回则允许删除
    // 可以在这里添加确认对话框等逻辑
    return false;
  }
});
```

## 已修复的问题

### 粘贴图片时的错误修复

**问题**: 之前在粘贴图片到节点时会报错:
```
TypeError: Assignment to constant variable.
at Ml.Ba [as createImgNode]
```

**原因**: `nodeCreateContents.js` 文件中的 `createImgNode` 函数中,`img` 变量被声明为 `const`,但后续尝试重新赋值。

**修复**: 已将 `const img` 改为 `let img`,允许变量重新赋值。

修复位置: `mind-map/simple-mind-map/src/core/render/node/nodeCreateContents.js` 第44行

## 注意事项

1. **图片比例**: 调整图片大小时会自动保持原始宽高比例
2. **性能**: 如果思维导图中包含大量图片,建议适当控制图片尺寸以保证性能
3. **保存**: 调整后的图片尺寸会自动保存到节点数据中的 `imageSize` 属性

## 技术细节

图片数据结构:
```javascript
{
  image: 'url',           // 图片URL
  imageTitle: 'title',    // 图片标题(可选)
  imageSize: {
    width: 200,           // 图片宽度
    height: 150,          // 图片高度
    custom: true          // 是否自定义了尺寸
  }
}
```

当 `custom` 为 `true` 时,表示用户手动调整过图片大小,此时图片不受主题的 `imgMaxWidth` 和 `imgMaxHeight` 限制。
